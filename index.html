<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberChronos OS v15.0 [Hyper-Terminal] | VoxTek Systems</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <style>
        /* =========================================
           1. CORE VARIABLES & FONTS
           ========================================= */
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500&family=Rajdhani:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap'); /* Retro Terminal Font */

        :root {
            --primary: #00f0ff;
            --primary-dim: rgba(0, 240, 255, 0.15);
            --primary-glow: rgba(0, 240, 255, 0.6);
            --bg-deep: #050505;
            --window-bg: rgba(12, 16, 22, 0.95);
            --taskbar-bg: rgba(8, 8, 8, 0.9);
            --border: rgba(0, 240, 255, 0.3);
            --text-main: #e0f0ff;
            --text-muted: #8b9bb4;
            --danger: #ff3333;
            --success: #00ff9d;
            
            --font-code: 'Fira Code', monospace;
            --font-term: 'VT323', monospace; /* New Retro Font */
            --font-ui: 'Rajdhani', sans-serif;
            
            --taskbar-height: 45px;
        }

        /* =========================================
           2. GLOBAL RESET & WALLPAPER
           ========================================= */
        * { box-sizing: border-box; user-select: none; outline: none; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: var(--font-ui);
            height: 100vh; width: 100vw;
            overflow: hidden;
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(0, 240, 255, 0.05) 0%, transparent 60%),
                linear-gradient(rgba(0, 240, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 240, 255, 0.03) 1px, transparent 1px);
            background-size: 100% 100%, 40px 40px, 40px 40px;
        }

        /* =========================================
           3. DESKTOP AREA & ICONS
           ========================================= */
        #desktop {
            width: 100%; height: calc(100vh - var(--taskbar-height));
            position: relative;
            padding: 20px;
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
            align-content: flex-start;
            gap: 15px;
        }

        .desktop-icon {
            width: 90px; height: 100px;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            border: 1px solid transparent;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.2s;
            color: #fff;
            text-align: center;
        }

        .desktop-icon:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
            text-shadow: 0 0 8px var(--primary);
        }
        
        .desktop-icon:active { background: var(--primary-dim); }

        .d-icon-img {
            font-size: 2.5rem; margin-bottom: 5px;
            filter: drop-shadow(0 0 5px rgba(0,240,255,0.5));
        }
        .d-icon-label { font-size: 0.8rem; font-weight: 500; text-shadow: 0 1px 3px #000; }

        /* =========================================
           4. WINDOW SYSTEM
           ========================================= */
        .window {
            position: absolute;
            background: var(--window-bg);
            border: 1px solid var(--border);
            border-radius: 6px 6px 0 0;
            box-shadow: 0 10px 50px rgba(0,0,0,0.9), 0 0 10px rgba(0,240,255,0.1);
            display: flex; flex-direction: column;
            min-width: 300px; min-height: 200px;
            backdrop-filter: blur(15px);
            opacity: 0; transform: scale(0.95);
            overflow: hidden;
            resize: both; 
            transition: 
                width 0.4s cubic-bezier(0.2, 0.8, 0.2, 1),
                height 0.4s cubic-bezier(0.2, 0.8, 0.2, 1),
                top 0.4s cubic-bezier(0.2, 0.8, 0.2, 1),
                left 0.4s cubic-bezier(0.2, 0.8, 0.2, 1),
                opacity 0.2s, transform 0.2s;
        }

        .window.open { opacity: 1; transform: scale(1); }
        .window.minimized { opacity: 0; transform: scale(0.8) translateY(200px); pointer-events: none; }
        
        .window.maximized {
            top: 0 !important; left: 0 !important;
            width: 100% !important; height: calc(100vh - var(--taskbar-height)) !important;
            border-radius: 0 !important; resize: none !important; transform: none !important;
        }

        .title-bar {
            height: 32px;
            background: linear-gradient(90deg, rgba(5,10,15,0.95) 0%, rgba(20,30,40,0.9) 100%);
            border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 10px; cursor: default;
        }
        
        .window.maximized .title-bar { cursor: default; }
        
        .title-drag-area {
            flex: 1; height: 100%; display: flex; align-items: center;
            font-family: var(--font-ui); font-size: 0.85rem; letter-spacing: 2px;
            text-transform: uppercase; color: var(--text-muted);
            user-select: none;
        }

        .win-controls { display: flex; gap: 8px; }
        .win-btn {
            width: 11px; height: 11px; border-radius: 50%;
            border: none; cursor: pointer; transition: 0.2s; position: relative;
        }
        .win-btn.close { background: #ff4757; }
        .win-btn.min { background: #ffa502; }
        .win-btn.max { background: #2ed573; }
        .win-btn:hover { transform: scale(1.2); filter: brightness(1.2); }

        .window-content {
            flex: 1; position: relative; overflow: hidden;
            background: rgba(0,0,0,0.8);
        }

        /* Shield for dragging over iframes */
        .iframe-shield {
            position: absolute; top:0; left:0; width:100%; height:100%;
            display: none; z-index: 50;
        }
        .window.dragging .iframe-shield { display: block; }

        /* =========================================
           5. RADICALLY IMPROVED TERMINAL (CRT STYLE)
           ========================================= */
        /* Container for CRT effects */
        .term-crt-container {
            width: 100%; height: 100%;
            background-color: #050505;
            position: relative;
            overflow: hidden;
        }

        /* Scanline Overlay */
        .scanlines {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.2) 50%,
                rgba(0,0,0,0.2)
            );
            background-size: 100% 4px;
            pointer-events: none; z-index: 5;
        }

        /* Slight Flicker Animation */
        @keyframes flicker {
            0% { opacity: 0.97; } 5% { opacity: 0.95; } 10% { opacity: 0.9; } 15% { opacity: 0.95; } 20% { opacity: 0.99; }
            50% { opacity: 0.95; } 80% { opacity: 0.9; } 100% { opacity: 0.97; }
        }

        /* Glow & Text */
        .term-body {
            width: 100%; height: 100%;
            padding: 15px; overflow-y: auto;
            font-family: var(--font-term); /* Retro Font */
            font-size: 1.1rem;
            color: var(--primary);
            text-shadow: 0 0 4px var(--primary-glow);
            animation: flicker 0.15s infinite;
        }
        
        /* Custom Scrollbar for Terminal */
        .term-body::-webkit-scrollbar { width: 10px; background: #000; }
        .term-body::-webkit-scrollbar-thumb { background: var(--primary); border: 2px solid #000; }

        .term-row { 
            margin-bottom: 2px; line-height: 1.2; 
            white-space: pre-wrap; word-wrap: break-word; 
        }

        .input-line { 
            display: flex; margin-top: 10px; 
            color: #fff; text-shadow: 0 0 4px #fff;
        }

        .cmd-input { 
            background: transparent; border: none; color: #fff; flex: 1; 
            font-family: var(--font-term); font-size: 1.1rem; margin-left: 10px;
            caret-color: var(--primary); text-shadow: 0 0 4px #fff;
            text-transform: none;
        }

        /* Blinking Cursor Block for retro feel */
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        .cursor-block {
            display: inline-block; width: 8px; height: 15px; 
            background: var(--primary); animation: blink 1s infinite;
            vertical-align: middle; margin-left: 5px;
        }

        /* =========================================
           6. TASKBAR & START MENU
           ========================================= */
        #taskbar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: var(--taskbar-height);
            background: var(--taskbar-bg);
            border-top: 1px solid rgba(255,255,255,0.15);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; z-index: 9999;
            backdrop-filter: blur(10px);
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }

        .start-btn {
            font-size: 1.5rem; color: var(--primary); cursor: pointer;
            margin-right: 15px; transition: 0.3s; width: 35px; height: 35px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 4px;
        }
        .start-btn:hover { 
            background: var(--primary-dim); 
            box-shadow: 0 0 15px var(--primary-glow);
        }

        .task-list {
            flex: 1; display: flex; gap: 5px; height: 100%; align-items: center;
            padding-left: 10px;
        }

        .task-tab {
            height: 35px; padding: 0 15px; min-width: 140px;
            background: rgba(255,255,255,0.03);
            border-bottom: 2px solid transparent;
            color: var(--text-muted);
            display: flex; align-items: center; gap: 8px;
            font-size: 0.85rem; cursor: pointer;
            transition: 0.2s; border-radius: 4px;
        }
        .task-tab:hover { background: rgba(255,255,255,0.08); color: #fff; }
        .task-tab.active { 
            background: rgba(0, 240, 255, 0.08); 
            border-bottom: 2px solid var(--primary); 
            color: var(--primary); text-shadow: 0 0 5px var(--primary-glow);
        }

        .sys-tray {
            display: flex; gap: 15px; align-items: center;
            font-size: 0.8rem; font-family: var(--font-code); color: #fff;
        }

        /* Start Menu */
        #start-menu {
            position: absolute; bottom: 55px; left: 10px;
            width: 260px; background: rgba(10,15,22,0.98);
            border: 1px solid var(--border);
            padding: 5px; display: none; flex-direction: column; gap: 2px;
            z-index: 10000; box-shadow: 0 0 30px rgba(0,0,0,0.8);
            border-radius: 6px;
        }
        #start-menu.show { display: flex; animation: slideUp 0.2s ease-out; }
        
        .sm-header {
            padding: 12px 15px; background: linear-gradient(90deg, var(--primary-dim), transparent);
            border-bottom: 1px solid #333; margin-bottom: 5px;
            color: #fff; font-weight: bold; letter-spacing: 1px;
            display: flex; align-items: center; gap: 10px;
        }
        .sm-item {
            padding: 12px 15px; cursor: pointer; color: #ccc; transition: 0.2s;
            display: flex; align-items: center; gap: 12px; border-radius: 4px;
            font-family: var(--font-ui); font-size: 0.9rem;
        }
        .sm-item:hover { background: var(--primary); color: #000; font-weight: bold; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Status Grid Styles */
        .status-grid { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 20px; 
            color: #fff; height: 100%; overflow-y: auto;
        }
        .stat-card {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1);
            padding: 15px; display: flex; flex-direction: column; transition: 0.3s;
        }
        .stat-card:hover { border-color: var(--primary); box-shadow: 0 0 15px rgba(0,240,255,0.1); }
        .stat-val { font-size: 1.5rem; color: var(--primary); font-family: var(--font-code); text-shadow: 0 0 5px var(--primary-glow); }
        .stat-lbl { font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 1px; }

        iframe.full-frame { width: 100%; height: 100%; border: none; background: #fff; }
    </style>
</head>
<body>

    <div id="desktop">
        <div class="desktop-icon" onclick="wm.open('term')">
            <div class="d-icon-img" style="color:#00ff9d;">_></div>
            <div class="d-icon-label">Terminal</div>
        </div>
        <div class="desktop-icon" onclick="wm.open('web')">
            <div class="d-icon-img" style="color:#00f0ff;">üåê</div>
            <div class="d-icon-label">VoxNet</div>
        </div>
        <div class="desktop-icon" onclick="wm.open('sys')">
            <div class="d-icon-img" style="color:#ffbd2e;">‚ö°</div>
            <div class="d-icon-label">SysInfo</div>
        </div>
        <div class="desktop-icon" onclick="wm.open('files')">
            <div class="d-icon-img" style="color:#ff4757;">üìÅ</div>
            <div class="d-icon-label">Encrypted</div>
        </div>
    </div>

    <div id="start-menu">
        <div class="sm-header">
            <span>CyberChronos</span> <span style="font-size:0.7em; opacity:0.7">v15.0</span>
        </div>
        <div class="sm-item" onclick="wm.open('term')"><span>_></span> Terminal Emulator</div>
        <div class="sm-item" onclick="wm.open('web')"><span>üåê</span> VoxTek Network</div>
        <div class="sm-item" onclick="wm.open('sys')"><span>‚ö°</span> System Monitor</div>
        <div style="height:1px; background:#333; margin:5px 0;"></div>
        <div class="sm-item" onclick="location.reload()"><span>‚Ü∫</span> Reboot System</div>
        <div class="sm-item" style="color:#ff4757" onclick="alert('Shutdown protocol locked by Admin.')"><span>‚èª</span> Shut Down</div>
    </div>

    <div id="win-term" class="window" style="top: 50px; left: 50px; width: 700px; height: 500px;">
        <div class="title-bar" onmousedown="wm.startDrag(event, 'win-term')">
            <div class="title-drag-area">root@CyberChronos:~/home</div>
            <div class="win-controls">
                <button class="win-btn min" onclick="wm.minimize('win-term')"></button>
                <button class="win-btn max" onclick="wm.toggleMaximize('win-term')"></button>
                <button class="win-btn close" onclick="wm.close('win-term')"></button>
            </div>
        </div>
        <div class="window-content" onclick="document.getElementById('cmd-in').focus()">
            <div class="term-crt-container">
                <div class="scanlines"></div>
                <div class="term-body" id="term-box">
                    <div id="term-output"></div>
                    <div class="input-line" id="input-line" style="display:none;">
                        <span id="prompt-span" style="color:var(--success); text-shadow:0 0 5px var(--success);">root@CyberChronos:~#</span>
                        <input type="text" id="cmd-in" class="cmd-input" autocomplete="off" spellcheck="false">
                        <div class="cursor-block"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="win-web" class="window" style="top: 80px; left: 100px; width: 900px; height: 600px;">
        <div class="title-bar" onmousedown="wm.startDrag(event, 'win-web')">
            <div class="title-drag-area">VoxTek Global Network [V-Sync Active]</div>
            <div class="win-controls">
                <button class="win-btn min" onclick="wm.minimize('win-web')"></button>
                <button class="win-btn max" onclick="wm.toggleMaximize('win-web')"></button>
                <button class="win-btn close" onclick="wm.close('win-web')"></button>
            </div>
        </div>
        <div class="window-content">
            <div class="iframe-shield"></div>
            <iframe id="vox-frame" class="full-frame" src="about:blank"></iframe>
        </div>
    </div>

    <div id="win-sys" class="window" style="top: 120px; left: 150px; width: 500px; height: 400px;">
        <div class="title-bar" onmousedown="wm.startDrag(event, 'win-sys')">
            <div class="title-drag-area">Hardware Monitor</div>
            <div class="win-controls">
                <button class="win-btn min" onclick="wm.minimize('win-sys')"></button>
                <button class="win-btn max" onclick="wm.toggleMaximize('win-sys')"></button>
                <button class="win-btn close" onclick="wm.close('win-sys')"></button>
            </div>
        </div>
        <div class="window-content">
            <div class="status-grid">
                <div class="stat-card">
                    <div class="stat-lbl">CPU Load</div>
                    <div class="stat-val" id="cpu-val">12%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-lbl">Memory</div>
                    <div class="stat-val">4.2 GB</div>
                </div>
                <div class="stat-card">
                    <div class="stat-lbl">Network</div>
                    <div class="stat-val" style="color:var(--success)">SECURE</div>
                </div>
                <div class="stat-card">
                    <div class="stat-lbl">V-Sync Status</div>
                    <div class="stat-val" id="vsync-stat" style="color:var(--warning)">WAITING</div>
                </div>
                <div class="stat-card" style="grid-column: span 2;">
                    <div class="stat-lbl">Host Identity</div>
                    <div class="stat-val" style="font-size:1rem;" id="host-name">Detecting...</div>
                </div>
            </div>
        </div>
    </div>

    <div id="taskbar">
        <div class="start-btn" onclick="toggleStartMenu()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
        </div>
        <div class="task-list" id="task-list">
            </div>
        <div class="sys-tray">
            <span id="net-icon" style="color:var(--warning)">‚ö† NET</span>
            <span id="clock" style="font-weight:bold; color:var(--primary)">00:00</span>
        </div>
    </div>

    <script>
        /* =========================================
           1. WINDOW MANAGER
           ========================================= */
        const wm = {
            zIndex: 100,
            windows: {
                'term': { id: 'win-term', title: 'Terminal', icon: '_>' },
                'web':  { id: 'win-web', title: 'VoxNet', icon: 'üåê' },
                'sys':  { id: 'win-sys', title: 'System', icon: '‚ö°' },
                'files': { id: null, title: 'Encrypted', icon: 'üîí' }
            },
            
            open: function(key) {
                if(key === 'files') {
                    // Easter egg alert
                    alert("ERROR: 403 FORBIDDEN. Biometric scan required for [SECRET_FILES].");
                    return;
                }

                const winData = this.windows[key];
                const el = document.getElementById(winData.id);
                
                el.style.display = 'flex';
                setTimeout(() => {
                    el.classList.add('open');
                    el.classList.remove('minimized');
                }, 10);
                
                this.bringToFront(el);
                this.updateTaskbar();

                if(key === 'web') loadExternalSite();
                if(key === 'term' && !termBooted) bootTerminal(); // Start boot sequence only once
                
                document.getElementById('start-menu').classList.remove('show');
            },

            close: function(id) {
                const el = document.getElementById(id);
                el.classList.remove('open');
                el.classList.remove('maximized');
                setTimeout(() => el.style.display = 'none', 300);
                setTimeout(() => this.updateTaskbar(), 350);
            },

            minimize: function(id) {
                const el = document.getElementById(id);
                el.classList.remove('open');
                el.classList.remove('maximized');
                el.classList.add('minimized');
                this.updateTaskbar();
            },

            toggleMaximize: function(id) {
                const el = document.getElementById(id);
                this.bringToFront(el);
                el.classList.toggle('maximized');
            },

            bringToFront: function(el) {
                this.zIndex++;
                el.style.zIndex = this.zIndex;
                this.updateTaskbar();
            },

            updateTaskbar: function() {
                const list = document.getElementById('task-list');
                list.innerHTML = '';
                Object.keys(this.windows).forEach(key => {
                    const winData = this.windows[key];
                    if(!winData.id) return;
                    const el = document.getElementById(winData.id);
                    if(el.style.display !== 'none' && el.style.display !== '') {
                        const tab = document.createElement('div');
                        tab.className = 'task-tab';
                        if(!el.classList.contains('minimized') && el.style.zIndex == this.zIndex) tab.classList.add('active');
                        tab.innerHTML = `<span>${winData.icon}</span> ${winData.title}`;
                        tab.onclick = () => {
                            if(el.classList.contains('minimized')) {
                                el.classList.remove('minimized');
                                setTimeout(() => el.classList.add('open'), 10);
                                this.bringToFront(el);
                            } else if(el.style.zIndex != this.zIndex) {
                                this.bringToFront(el);
                            } else {
                                this.minimize(winData.id);
                            }
                        };
                        list.appendChild(tab);
                    }
                });
            },

            startDrag: function(e, id) {
                const el = document.getElementById(id);
                if(el.classList.contains('maximized')) return;
                this.bringToFront(el);
                el.classList.add('dragging');
                
                let shiftX = e.clientX - el.getBoundingClientRect().left;
                let shiftY = e.clientY - el.getBoundingClientRect().top;
                el.style.transition = 'none';

                function moveAt(pageX, pageY) {
                    el.style.left = pageX - shiftX + 'px';
                    el.style.top = pageY - shiftY + 'px';
                }
                function onMouseMove(event) { moveAt(event.pageX, event.pageY); }

                document.addEventListener('mousemove', onMouseMove);
                document.onmouseup = function() {
                    document.removeEventListener('mousemove', onMouseMove);
                    el.classList.remove('dragging');
                    el.style.transition = ''; 
                    document.onmouseup = null;
                };
            }
        };

        /* =========================================
           2. SYSTEM LOGIC
           ========================================= */
        function updateClock() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2,'0');
            const m = String(now.getMinutes()).padStart(2,'0');
            document.getElementById('clock').innerText = `${h}:${m}`;
        }
        setInterval(updateClock, 1000);

        function toggleStartMenu() {
            document.getElementById('start-menu').classList.toggle('show');
        }
        document.getElementById('desktop').addEventListener('click', (e) => {
            if(e.target === document.getElementById('desktop')) document.getElementById('start-menu').classList.remove('show');
        });

        /* =========================================
           3. ADVANCED TERMINAL LOGIC (BOOT & FILE SYS)
           ========================================= */
        const cmdIn = document.getElementById('cmd-in');
        const termOut = document.getElementById('term-output');
        const termBox = document.getElementById('term-box');
        const inputLine = document.getElementById('input-line');
        const promptSpan = document.getElementById('prompt-span');
        
        let cmdHistory = [];
        let historyIndex = -1;
        let termBooted = false;
        
        // Mock File System
        let currentPath = "/home/alexzahn";
        const fileSystem = {
            "/": { type: "dir", content: ["bin", "home", "var", "etc", "logs"] },
            "/bin": { type: "dir", content: ["ssh", "ping", "nmap", "hack", "matrix"] },
            "/home": { type: "dir", content: ["alexzahn"] },
            "/home/alexzahn": { type: "dir", content: ["notes.txt", "vox_plan.enc", "todo.list"] },
            "/var": { type: "dir", content: ["www", "log"] },
            "notes.txt": { type: "file", content: "To-Do: \n1. Sync with VoxTek Mainframe.\n2. Upgrade firewall.\n3. Watch Hazbin ep 8 again." },
            "todo.list": { type: "file", content: "- Destroy Alastor's radio towers\n- Buy more screens\n- Calibrate V-Sync" },
            "vox_plan.enc": { type: "file", content: "[ENCRYPTED DATA] - ACCESS DENIED" }
        };

        // Boot Animation
        async function bootTerminal() {
            termBooted = true;
            inputLine.style.display = 'none';
            
            const bootText = [
                "Initializing VoxTek Kernel v15.0...",
                "Loading memory... 64GB OK",
                "Checking CPU... Neural-Link OK",
                "Mounting filesystem... OK",
                "Starting V-Sync Protocol... CONNECTED",
                "Establishing secure tunnel to HellNet... SUCCESS",
                "----------------------------------------",
                "Welcome back, AleXZahn.",
                "System is ready."
            ];

            for (let line of bootText) {
                await typeText(line, "#00f0ff");
                await new Promise(r => setTimeout(r, 150));
            }
            
            inputLine.style.display = 'flex';
            cmdIn.focus();
        }

        // Typing Effect Function
        function typeText(text, color="#fff", speed=10) {
            return new Promise(resolve => {
                const div = document.createElement('div');
                div.className = 'term-row';
                div.style.color = color;
                termOut.appendChild(div);
                
                let i = 0;
                function type() {
                    if (i < text.length) {
                        div.textContent += text.charAt(i);
                        i++;
                        termBox.scrollTop = termBox.scrollHeight;
                        setTimeout(type, speed);
                    } else {
                        resolve();
                    }
                }
                type();
            });
        }

        function simpleLog(text, color="#ccc") {
            const div = document.createElement('div');
            div.className = 'term-row';
            div.style.color = color;
            div.textContent = text;
            termOut.appendChild(div);
            termBox.scrollTop = termBox.scrollHeight;
        }

        // Command Processing
        cmdIn.addEventListener('keydown', (e) => {
            if(e.key === 'Enter') {
                const raw = cmdIn.value;
                if(!raw.trim()) return;
                
                cmdHistory.push(raw);
                historyIndex = cmdHistory.length;
                
                simpleLog(`${promptSpan.innerText} ${raw}`, "#fff");
                processCommand(raw.trim());
                cmdIn.value = '';
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (historyIndex > 0) { historyIndex--; cmdIn.value = cmdHistory[historyIndex]; }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (historyIndex < cmdHistory.length - 1) { historyIndex++; cmdIn.value = cmdHistory[historyIndex]; }
                else { historyIndex = cmdHistory.length; cmdIn.value = ''; }
            }
        });

        async function processCommand(cmd) {
            const parts = cmd.split(' ');
            const c = parts[0].toLowerCase();
            const arg = parts[1];

            switch(c) {
                case 'help':
                    simpleLog("Available Commands:");
                    simpleLog("  ls        - List directory contents");
                    simpleLog("  cd [dir]  - Change directory");
                    simpleLog("  cat [file]- Read file content");
                    simpleLog("  ping web  - Test VoxNet latency");
                    simpleLog("  clear     - Clear terminal");
                    simpleLog("  matrix    - Run visualizer");
                    break;
                
                case 'clear':
                    termOut.innerHTML = '';
                    break;

                case 'ls':
                    const dir = fileSystem[currentPath];
                    if(dir && dir.type === 'dir') {
                        simpleLog(dir.content.join("   "), "var(--primary)");
                    } else {
                        simpleLog("Error: Directory not found", "var(--danger)");
                    }
                    break;

                case 'cd':
                    if(!arg || arg === "~") {
                        currentPath = "/home/alexzahn";
                    } else if(arg === "..") {
                        // Very simple parent logic
                        if(currentPath !== "/") {
                            const pathParts = currentPath.split('/');
                            pathParts.pop();
                            currentPath = pathParts.join('/') || "/";
                        }
                    } else {
                        const target = currentPath === "/" ? `/${arg}` : `${currentPath}/${arg}`;
                        if(fileSystem[target] && fileSystem[target].type === 'dir') {
                            currentPath = target;
                        } else {
                            simpleLog(`bash: cd: ${arg}: No such directory`, "var(--danger)");
                        }
                    }
                    promptSpan.innerText = `root@CyberChronos:${currentPath === "/home/alexzahn" ? "~" : currentPath}#`;
                    break;

                case 'cat':
                    if(fileSystem[arg] && fileSystem[arg].type === 'file') {
                        simpleLog(fileSystem[arg].content, "#ccc");
                    } else {
                        simpleLog(`cat: ${arg}: No such file`, "var(--danger)");
                    }
                    break;

                case 'ping':
                    if(arg === 'web') {
                        const iframe = document.getElementById('vox-frame');
                        if(iframe.src === 'about:blank') {
                            simpleLog("Error: VoxNet browser not open.", "var(--danger)");
                        } else {
                            simpleLog("Pinging VoxTek Mainframe...", "var(--warning)");
                            iframe.contentWindow.postMessage({ type: 'PING' }, "https://voxtek-site.vercel.app");
                        }
                    } else {
                        simpleLog("Usage: ping web");
                    }
                    break;
                
                case 'matrix':
                    simpleLog("Wake up, Neo...", "#00ff00");
                    for(let i=0; i<10; i++) {
                        await new Promise(r => setTimeout(r, 100));
                        simpleLog(`01010101010111000101010101 ${Math.random()}`, "#00ff00");
                    }
                    break;

                default:
                    simpleLog(`bash: ${c}: command not found`, "var(--danger)");
            }
        }

        /* =========================================
           4. FIREBASE & IFRAME (Backend)
           ========================================= */
        const firebaseConfig = {
            apiKey: "AIzaSyDaYxxhxjrvjVgqYcvPH53989Wr5dMgqHI",
            authDomain: "voxtek-system.firebaseapp.com",
            projectId: "voxtek-system",
            storageBucket: "voxtek-system.firebasestorage.app",
            messagingSenderId: "137141100080",
            appId: "1:137141100080:web:1b798f2e7aa12a313cd7f5"
        };
        try {
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();
            auth.signInAnonymously().then(user => {
                document.getElementById('net-icon').innerText = "‚óè NET";
                document.getElementById('net-icon').style.color = "var(--success)";
                const savedName = localStorage.getItem('cc_host') || 'CyberChronos';
                document.getElementById('host-name').innerText = savedName;
                db.collection('users').doc(user.user.uid).set({
                    name: savedName, status: 'ONLINE', lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
            });
        } catch(e) { console.log("Offline Mode"); }

        let iframeLoaded = false;
        function loadExternalSite() {
            if(iframeLoaded) return;
            const userName = localStorage.getItem('cc_host') || 'AleXZahn';
            const targetUrl = `https://voxtek-site.vercel.app?os=cyberchronos&user=${encodeURIComponent(userName)}`;
            document.getElementById('vox-frame').src = targetUrl;
            iframeLoaded = true;
        }

        window.addEventListener('message', (event) => {
            if (event.origin !== "https://voxtek-site.vercel.app") return;
            if (event.data.type === 'PONG') {
                simpleLog(`>> Reply: ${event.data.message}`, "var(--success)");
                document.getElementById('vsync-stat').innerText = "SYNCED";
                document.getElementById('vsync-stat').style.color = "var(--success)";
            }
        });

        updateClock();
    </script>
</body>
</html>
